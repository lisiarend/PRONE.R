---
title: "PRONE.R - Proteomics Normalization Evaluater"
author: Arend Lis

output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{PRONE.R}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

## Introduction {-}


## Installation {-}

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>", eval = FALSE
)
```

```{r loading, include=TRUE, warning=FALSE, message=FALSE}
  # Install PRONE.R from github and build vignettes
  if (!requireNamespace("devtools", quietly = TRUE)) install.packages("devtools")
  devtools::install_github("lisiarend/PRONE.R", build_vignettes = TRUE, dependencies = TRUE)
  # Load and attach PRONE.R 
  library("PRONE.R")
```


## Load Data {-}


### Example 1: TMT Data Set

```{r}
data <- read.csv("../inst/extdata/real_world/TMT/proteinGroups_harmonized_plasma.csv", row.names = 1)
md <- read.csv("../inst/extdata/real_world/TMT/metadata_plasma.csv", row.names = 1)

ref_samples <- md[md$Condition == "ref",]$Column

se <- load_data(data, md, protein_column = "Protein.IDs", gene_column = "Gene.names", ref_samples = ref_samples, batch_column = "Batch", condition_column = "Condition", label_column = "Label")

```

### Example 2: LFQ Data Set

```{r}

#data <- read.csv("../inst/extdata/real_world/LFQ/MOUSE-Data-NonNormalized.csv", row.names = 1)

# Create metadata (since it was not given)
#md <- data.frame(Column = colnames(data)[1:(ncol(data)-2)])
#md$Animal <- sapply(strsplit(as.character(md$Column),"_"), "[", 1)
#md$Condition <- sapply(strsplit(as.character(md$Column),"_"), "[", 2)

#se <- load_data(data, md, protein_column = "Accession", gene_column = NULL, ref_samples = NULL, batch_column = NULL, condition_column = "Condition", label_column = NULL)
```


## Overview of the Data {-}

```{r}
get_NA_overview(se, ain = "log2")
```

```{r}
plot_condition_overview(se, condition = NULL)

plot_condition_overview(se, condition = "Batch")

```


## Filter Proteins {-}

### Remove Proteins With Missing Values in ALL Samples

```{r}
se <- filter_complete_NA_proteins(se)
```

### Remove Proteins With a Specific Value in a Specific Column

Typically proteins with "+" in the columns "Reverse", "Only.identified.by.site", and "Potential.contaminant" are removed in case of a MaxQuant proteinGroups.txt output file.

```{r}
se <- filter_proteins_by_value(se, "Reverse", "+")
se <- filter_proteins_by_value(se, "Potential.contaminant", "+")
se <- filter_proteins_by_value(se, "Only.identified.by.site", "+")
```


## Explore Missing Value Pattern

```{r}

plot_NA_heatmap(se, color_by = NULL, label_by = NULL, cluster_samples = TRUE, cluster_proteins = TRUE)

plot_NA_heatmap(se, color_by = "Batch", label_by = "No", cluster_samples = TRUE, cluster_proteins = TRUE)

```

```{r}
plot_NA_density(se)
```

```{r}
plot_NA_frequency(se)
```
## Filter Proteins By Applying a Missing Value Threshold


```{r}
se <- filter_NA_proteins_by_threshold(se, thr = 0.7) 

plot_NA_heatmap(se)
```


## Filter Samples {-}


### Quality Control

```{r}

plot_nr_prot_samples(se, color_by = NULL, label_by = NULL)

plot_nr_prot_samples(se, color_by = "Batch", label_by = "No")

plot_nr_prot_samples(se, color_by = "No", label_by = "No")

```
